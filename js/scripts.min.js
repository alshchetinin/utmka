/*!
 * baffle 0.3.6 - A tiny javascript library for obfuscating and revealing text in DOM elements.
 * Copyright (c) 2016 Cam Wiegert <cam@camwiegert.com> - https://camwiegert.github.io/baffle
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.baffle=e():t.baffle=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),o=r(i);t.exports=o["default"]},function(t,e){"use strict";function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function r(t,e){return t.split("").map(e).join("")}function i(t){return t[Math.floor(Math.random()*t.length)]}function o(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}function u(t){return t.map(function(t,e){return!!t&&e}).filter(function(t){return t!==!1})}function s(t){return"string"==typeof t?[].slice.call(document.querySelectorAll(t)):[NodeList,HTMLCollection].some(function(e){return t instanceof e})?[].slice.call(t):t.nodeType?[t]:t}Object.defineProperty(e,"__esModule",{value:!0}),e.extend=n,e.mapString=r,e.sample=i,e.each=o,e.getTruthyIndices=u,e.getElements=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),u=n(3),s=r(u),c={characters:"AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz~!@#$%^&*()-+=[]{}|;:,./<>?",exclude:[" "],speed:50},a=function(){function t(e,n){i(this,t),this.options=(0,o.extend)(Object.create(c),n),this.elements=(0,o.getElements)(e).map(s["default"]),this.running=!1}return t.prototype.once=function(){var t=this;return(0,o.each)(this.elements,function(e){return e.write(t.options.characters,t.options.exclude)}),this.running=!0,this},t.prototype.start=function(){var t=this;return clearInterval(this.interval),(0,o.each)(this.elements,function(t){return t.init()}),this.interval=setInterval(function(){return t.once()},this.options.speed),this.running=!0,this},t.prototype.stop=function(){return clearInterval(this.interval),this.running=!1,this},t.prototype.set=function(t){return(0,o.extend)(this.options,t),this.running&&this.start(),this},t.prototype.text=function(t){var e=this;return(0,o.each)(this.elements,function(n){n.text(t(n.value)),e.running||n.write()}),this},t.prototype.reveal=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=e/this.options.speed||1,i=function(){clearInterval(t.interval),t.running=!0,t.interval=setInterval(function(){var e=t.elements.filter(function(t){return!t.bitmap.every(function(t){return!t})});(0,o.each)(e,function(e){var n=Math.ceil(e.value.length/r);e.decay(n).write(t.options.characters,t.options.exclude)}),e.length||(t.stop(),(0,o.each)(t.elements,function(t){return t.init()}))},t.options.speed)};return setTimeout(i,n),this},t}();e["default"]=function(t,e){return new a(t,e)}},function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),s=function(){function t(e){o(this,t),this.value=e,this.init()}return t.prototype.init=function(){return this.bitmap=this.value.split("").map(function(){return 1}),this},t.prototype.render=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return e.length?(0,u.mapString)(this.value,function(r,i){return n.indexOf(r)>-1?r:t.bitmap[i]?(0,u.sample)(e):r}):this.value},t.prototype.decay=function(){for(var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];t--;){var e=(0,u.getTruthyIndices)(this.bitmap);this.bitmap[(0,u.sample)(e)]=0}return this},t.prototype.text=function(){var t=arguments.length<=0||void 0===arguments[0]?this.value:arguments[0];return this.value=t,this.init(),this},t}(),c=function(t){function e(n){o(this,e);var i=r(this,t.call(this,n.textContent));return i.element=n,i}return i(e,t),e.prototype.write=function(t,e){return this.element.textContent=this.render(t,e),this},e}(s);e["default"]=function(t){return new c(t)}}])});
// Lazy loading img & background images using intersection observer
// Reference: https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/
// Using example: <img class="lazy" src="thumb.gif" data-src="real-img.jpg" data-srcset="real-img@1x.jpg 1x, real-img@2x.jpg 2x">
// Background image class usign example: <div class="lazy-background"> with added class ".visible" for styling
// Background image style attribute lazy loading example: <div data-bg="image.jpg">

// delete window.IntersectionObserver; // Fallback Testing

document.addEventListener('DOMContentLoaded', function() {

	var lazyImages = [].slice.call(document.querySelectorAll('img.lazy'));
	var lazyBackgrounds = [].slice.call(document.querySelectorAll('.lazy-background'));
	var lazyBackgroundsData = [].slice.call(document.querySelectorAll('[data-bg]'));

	if ('IntersectionObserver' in window) {

		let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					let lazyImage = entry.target;
					lazyImage.src = lazyImage.dataset.src;
					lazyImage.srcset = lazyImage.dataset.srcset;
					lazyImage.classList.remove('lazy');
					lazyImageObserver.unobserve(lazyImage);
				}
			});
		});
		lazyImages.forEach(function(lazyImage) {
			lazyImageObserver.observe(lazyImage);
		});

	let lazyBackgroundObserver = new IntersectionObserver(function(entries, observer) {
		entries.forEach(function(entry) {
			if (entry.isIntersecting) {
				entry.target.classList.add('visible');
				lazyBackgroundObserver.unobserve(entry.target);
			}
		});
	});
	lazyBackgrounds.forEach(function(lazyBackground) {
		lazyBackgroundObserver.observe(lazyBackground);
	});

	let lazyBackgroundDataObserver = new IntersectionObserver(function(entries, observer) {
		entries.forEach(function(entry) {
			if (entry.isIntersecting) {
				let lazyBackgroundData = entry.target;
				lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
				lazyBackgroundDataObserver.unobserve(lazyBackgroundData);
			}
		});
	});
	lazyBackgroundsData.forEach(function(lazyBackgroundData) {
		lazyBackgroundDataObserver.observe(lazyBackgroundData);
	});

	} else {

		// Fallback

		lazyImages.forEach(function(lazyImage) {
			lazyImage.src = lazyImage.dataset.src;
			lazyImage.srcset = lazyImage.dataset.srcset;
		});
		lazyBackgrounds.forEach(function(lazyBackground) {
			lazyBackground.classList.add('visible');
		});
		lazyBackgroundsData.forEach(function(lazyBackgroundData) {
			lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
		});

	}

});


document.addEventListener("DOMContentLoaded", function() {
  var $allInnput = document.querySelectorAll("input");
  var $href = document.querySelector("#href");
  var $result = document.querySelector("#result");
  var $resultWrapper = document.querySelector(".resultWrapper");
  var $vkccResult = document.querySelector(".vkcc_result");
  var $btnCopy = document.querySelector(".copy");
  var $btn = document.querySelectorAll(".btn");
  var $menu_item = document.querySelectorAll(".menu_item");
  var $theme = document.querySelector("#change_theme");
  var $body = document.querySelector("body");

  var $utm_source = document.querySelector("#utm_source");
  var $utm_medium = document.querySelector("#utm_medium");
  var $utm_campaign = document.querySelector("#utm_campaign");
  var $utm_content = document.querySelector("#utm_content");
  var $utm_term = document.querySelector("#utm_term");

  var utm_source = $utm_source.value;
  var utm_medium = $utm_medium.value;
  var utm_campaign = $utm_campaign.value;
  var utm_content = $utm_content.value;
  var utm_term = $utm_term.value;

  var objUtm = {
    yandexSearch: {
      utm_source: "yandex.search",
      utm_medium: "cpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexContext: {
      utm_source: "yandex.context",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexSmartBanner: {
      utm_source: "yandex.smart-banner",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexSearchBanner: {
      utm_source: "yandex.search-banner",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexMedia: {
      utm_source: "yandex.media",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexGraphics: {
      utm_source: "yandex.graphics",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    yandexMainPageBanner: {
      utm_source: "yandex.main-page-banner",
      utm_medium: "сpc",
      utm_campaign: "{campaign_id}",
      utm_content: "{ad_id}",
      utm_term: "{keyword}"
    },
    googleSearch: {
      utm_source: "google.search",
      utm_medium: "сpc",
      utm_campaign: "{campaignid}",
      utm_content: "{creative}",
      utm_term: "{keyword}"
    },
    googleKMS: {
      utm_source: "google.kms",
      utm_medium: "сpc",
      utm_campaign: "{campaignid}",
      utm_content: "{creative}",
      utm_term: "{keyword}"
    },
    googleVideo: {
      utm_source: "google.video",
      utm_medium: "сpc",
      utm_campaign: "{campaignid}",
      utm_content: "{creative}",
      utm_term: "{keyword}"
    },
    vk: {
      utm_source: "vk",
      utm_medium: "social",
      utm_campaign: "название поста"
    },
    ok: {
      utm_source: "ok",
      utm_medium: "social",
      utm_campaign: "название поста"
    },
    inst: {
      utm_source: "inst",
      utm_medium: "social",
      utm_campaign: "название поста"
    },
    fb: {
      utm_source: "fb",
      utm_medium: "social",
      utm_campaign: "название поста"
    }
  };

  console.log(objUtm);
  handlerActive($btn, "btn-active");

  $result.addEventListener("click", function(event) {
    copyClipboard($result);
    event.preventDefault();
  });

  $vkccResult.addEventListener("click", function(event) {
    copyClipboard($vkccResult);
    event.preventDefault();
  });

  if (localStorage.getItem("theme") == "Dark") {
    $body.classList.add("black_theme");
    document.querySelector("#change_theme img").src = "img/@2x/dark.png";
  } else {
    $body.classList.remove("black_theme");
    document.querySelector("#change_theme img").src = "img/@2x/light.png";
  }

  $theme.addEventListener("click", function(event) {
    $body.classList.toggle("black_theme");
    $body.style.transition = "all 0.5s ease-in-out";
    event.preventDefault();
    var bodyclass = $body.classList.contains("black_theme");
    if (bodyclass == true) {
      localStorage.setItem("theme", "Dark");
      document.querySelector("#change_theme img").src = "img/@2x/dark.png";
    } else {
      localStorage.setItem("theme", "light");
      document.querySelector("#change_theme img").src = "img/@2x/light.png";
    }
  });

  //Вывод результат
  for (i = 0; i < $allInnput.length; i++) {
    transliterate(this.value, { replace: { " ": "-" } });
    $allInnput[i].addEventListener("input", function() {
      result();
    });
  }
  $href.value = localStorage.getItem("href");

  // Табы
  var jsTriggers = document.querySelectorAll(".menu_item");
  jsTriggers.forEach(function(trigger) {
    trigger.addEventListener("click", function(event) {
      localStorage.setItem("idMenu", this.getAttribute("data-tab"));
      var idLocal = localStorage.getItem("idMenu");
      var content = document.querySelector(
        '.fillter[data-tab="' + idLocal + '"]'
      );
      var activeContent = document.querySelector(".tab-active");
      var activeTrigger = document.querySelector(".menu_item-active");
      activeTrigger.classList.remove("menu_item-active"); // 1
      trigger.classList.add("menu_item-active"); // 2
      activeContent.classList.remove("tab-active"); // 3
      content.classList.add("tab-active"); // 4
      event.preventDefault();
      //СММ

      if (
        document
          .querySelector('.fillter[data-tab="smm"]')
          .classList.contains("tab-active") == true
      ) {
        document.querySelector(".no-smm").style.display = "none";
        document.querySelector(".no-smm1").style.display = "none";
      } else {
        document.querySelector(".no-smm").style.display = "flex";
        document.querySelector(".no-smm1").style.display = "flex";
      }
    });
  });

  try {
    var activeContent = document.querySelector(".tab-active");
    activeContent.classList.remove("tab-active"); // 3
    var idLocal = localStorage.getItem("idMenu");
    var content = document.querySelector(
      '.fillter[data-tab="' + idLocal + '"]'
    );
    var activeTrigger = document.querySelector(".menu_item-active");
    activeTrigger.classList.remove("menu_item-active"); // 1
    document
      .querySelector('.menu_item[data-tab="' + idLocal + '"]')
      .classList.add("menu_item-active");
    content.classList.add("tab-active");
    if (idLocal === "smm") {
      document.querySelector(".no-smm").style.display = "none";
      document.querySelector(".no-smm1").style.display = "none";
    } else {
      document.querySelector(".no-smm").style.display = "flex";
      document.querySelector(".no-smm1").style.display = "flex";
    }
  } catch {
    document.querySelector(".default").classList.add("menu_item-active");
    document
      .querySelector('.fillter[data-tab="yandex"]')
      .classList.add("tab-active");
  }

  //Что нового
  document.querySelector(".news").addEventListener("click", function(event) {
    event.preventDefault();
    document.querySelector(".ol").classList.toggle("ol_visable");
    if (this.innerHTML === "Что нового?") {
      this.innerHTML = "Скрыть";
    } else {
      this.innerHTML = "Что нового?";
    }
  });

  //Добавление активного класса
  function handlerActive($el, activeClass) {
    for (var i = 0; i < $el.length; i++) {
      $el[i].addEventListener("click", function(event) {
        for (var i = 0; i < $el.length; i++) {
          $el[i].classList.remove(activeClass);
        }
        this.classList.toggle(activeClass);
        localStorage.setItem("ativeBtn", this.id);
        event.preventDefault();
      });
    }
  }

  $btn.forEach(function(click) {
    click.addEventListener("click", function(even) {
      createObjUtm();
      event.preventDefault();
      vkcc.style.display = "inline-block";
      $vkccResult.style.display = "none";
    });
  });

  createObjUtm();

  function createObjUtm() {
    var utmLocal = localStorage.getItem("ativeBtn");
    try {
      document.querySelector("#" + utmLocal).classList.add("btn-active");
      var utmObj = objUtm[utmLocal];
      var utmObjSourse = objUtm[utmLocal].utm_source;
      var utmObjMedium = objUtm[utmLocal].utm_medium;
      var utmObjCampaing = objUtm[utmLocal].utm_campaign;
      var utmObjContent = objUtm[utmLocal].utm_content;
      var utmObjTrem = objUtm[utmLocal].utm_term;

      creatUtm(
        utmObjSourse,
        utmObjMedium,
        utmObjCampaing,
        utmObjContent,
        utmObjTrem
      );
    } catch {}
  }

  function creatUtm(
    utm_source,
    utm_medium,
    utm_campaign,
    utm_content,
    utm_term
  ) {
    utm_source = $utm_source.value = utm_source;
    utm_medium = $utm_medium.value = utm_medium;
    utm_campaign = $utm_campaign.value = utm_campaign;
    utm_content = $utm_content.value = utm_content;
    utm_term = $utm_term.value = utm_term;
    result();
  }

  function result() {
    var hrefValue = $href.value;
    localStorage.setItem("href", $href.value);
    utm_source = transliterate($utm_source.value, { replace: { " ": "-" } });
    utm_medium = transliterate($utm_medium.value, { replace: { " ": "-" } });
    utm_campaign = transliterate($utm_campaign.value, {
      replace: { " ": "-" }
    });
    utm_content = transliterate($utm_content.value, { replace: { " ": "-" } });
    utm_term = transliterate($utm_term.value, { replace: { " ": "-" } });

    if (
      document
        .querySelector('.fillter[data-tab="smm"]')
        .classList.contains("tab-active") == true
    ) {
      var utm =
        "?utm_source=" +
        utm_source +
        "&utm_medium=" +
        utm_medium +
        "&utm_campaign=" +
        utm_campaign;
    } else {
      var utm =
        "?utm_source=" +
        utm_source +
        "&utm_medium=" +
        utm_medium +
        "&utm_campaign=" +
        utm_campaign +
        "&utm_content=" +
        utm_content +
        "&utm_term=" +
        utm_term;
    }

    if (hrefValue.indexOf("?") > -1) {
      //yandexADS.replace("?", "&");
      $result.innerHTML = hrefValue + utm.replace("?", "&");
    } else {
      $result.innerHTML = hrefValue + utm;
    }
  }

  function copyClipboard(elem) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    document.execCommand("copy");
    window.getSelection().removeAllRanges();

    document.querySelector(".copyDone").style.opacity = "1";
    setTimeout(hide, 1000);
    function hide() {
      document.querySelector(".copyDone").style.opacity = "0";
    }
  }

  //vk cc
  const token =
    "38b49d7d38b49d7d38b49d7df538d95801338b438b49d7d650a3d3ce42566e7e243febe";
  const v = "5.103";
  const metod = "utils.getShortLink";

  const vkcc = document.querySelector("#vkcc");
  vkcc.addEventListener("click", href_cut);

  function href_cut() {
    event.preventDefault();
    const $result_utm = $result.textContent;
    //const proxyurl = "https://cors-anywhere.herokuapp.com/";
    const url = `https://api.vk.com/method/${metod}?url=${$result_utm}&access_token=${token}&v=${v}`;
    console.log($result_utm);

    const vkccResponce = VK.Api.call(
      metod,
      { url: $result_utm, v: "5.73" },
      function(response) {
        try {
          $vkccResult.innerHTML = response.response.short_url;
          console.log(response.response.short_url);
          vkcc.style.display = "none";
          $vkccResult.style.display = "block";
        } catch {
          vkcc.innerHTML =
            "Что-то пошло не так, возможно не выполнен логин в ВК в бразуере";
          vkcc.style.color = "#FF403C";
        }
      }
    );
  }

  $href.addEventListener("input", function() {
    vkcc.style.display = "inline-block";
    $vkccResult.style.display = "none";
  });
});
